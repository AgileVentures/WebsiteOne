language: ruby
rvm:
- 2.1.1
bundler_args: "--without development --path=~/.bundle"
before_install:
- 'echo ''gem: --no-ri --no-rdoc'' > ~/.gemrc'
- gem install nokogiri -- --use-system-libraries
- gem install bundler bundle_cache
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- sudo rm /etc/apt/sources.list.d/git-ppa-source.list
- sudo apt-get remove git && sudo apt-get remove git-man && sudo apt-get install git-man
  && sudo apt-get install git
- bundle_cache_install
before_script:
- bundle exec rake db:create:all
- bundle exec rake db:migrate
script:
- bundle exec rspec --format progress
- bundle exec rake jasmine:ci
- xvfb-run bundle exec cucumber --profile ci
after_script:
- bundle_cache
deploy:
  provider: heroku
  api_key:
    secure: qjGSUm5TSMjgarhzvBnZhNVyMcLCXpszb68D+aj9rKtNwHggz2dmCyqATr3Ynl38I193/QEaOUEarHguI7ABSW6SCmdAIoAEP/h7bbyOgLAYV9+ct/qhk8N4PdjnKUYUYZ9lsd5UcErMMgD03USQg3CeG1X1LwSX18jcScBHkss=
  strategy: git
  app:
    develop: websiteone-develop
    staging: websiteone-staging
    master: websiteone-production
  run: rake db:migrate
env:
  global:
  - BUNDLE_ARCHIVE: websiteone-bundler-cache
  - AWS_S3_BUCKET: Travis-BundlerCache
  - secure: Ex7uGwVQN9fnBFsWXHOVfdVxcUaGcKT5m2KecFuZUknJhAg5i1qWVBN6tEzQYensWBoRXKjwaAVYxb1NK34wDaCg94wJv66l2M0gIchMhtrn/xc2k0SWZqLrryFRiONahlt4dwqohzxzF5suDu/IlssxZWKX0MEZkIaOVkz7jGM=
  - secure: cWwCHNVbHdLEe1UNpkOXdK4ubu/xqIuiwL+8RqkiLkPXWJbkYvKKQipO+XW8oih/NupyFT6uJ+bRHptqC0OVITlPl5X3C3iQ1C42xQAdiDqFnMKtGZsYyuuoJnbAMAKx+fd6J/S5hiCUZjqtQy95ow3qvdP10m6RJWfTQduxNZ4=
notifications:
  email:
  - thomas@nocebo.se
  - info@agileventures.org
