language: ruby
rvm:
- 2.0.0-p353

# to enable javascript testing with X server and firefox
before_install:
  - gem install bundler
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"

before_script:
- bundle exec rake db:create:all
- bundle exec rake db:migrate
- bundle exec rake db:test:prepare

script:
- bundle exec rake cucumber
- CODECLIMATE_REPO_TOKEN=7d45ffb2dbf367f8158a6e65d4d50f8f0ac035c2027bdb33e2aaccb57d43ee91 bundle exec rake spec
- bundle exec rake jasmine:ci
deploy:
  provider: heroku
  api_key:
    secure: qjGSUm5TSMjgarhzvBnZhNVyMcLCXpszb68D+aj9rKtNwHggz2dmCyqATr3Ynl38I193/QEaOUEarHguI7ABSW6SCmdAIoAEP/h7bbyOgLAYV9+ct/qhk8N4PdjnKUYUYZ9lsd5UcErMMgD03USQg3CeG1X1LwSX18jcScBHkss=
  strategy: git
  app:
      develop: websiteone-develop
      staging: websiteone-staging
      master: websiteone-production
  run: "rake db:migrate"
