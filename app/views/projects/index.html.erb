<% provide :title, 'Projects' %>
  <div class="row">
    <div class="col-xs-9">
      <h1 id="projects-header">Projects By Recent Activity</h1>
    </div>
    <div class="col-xs-3">
      <% if user_signed_in? %>
        <ul class="user-controls new-project-btn">
          <li><%= custom_css_btn 'new project', 'fa-2x fa fa-plus', new_project_path %></li>
        </ul>
      <% end %>
    </div>
  </div>

  <% if @projects.empty? %>
    <p>We have no projects right now&#8230;</p>
  <% else %>
    <div class="col-sm-12 well">
    <p>Filter projects by</p>
    <%= form_tag(projects_path, method: "get", class: "form-inline text-left") do %>
        <div class="row">
          <div class="col-xs-12 col-sm-4">
            <%= select_tag :language, options_for_select(@projects_languages_array, params[:language]), {prompt: 'Language...', class: 'form-control'} %>
          </div>
          <div class="col-xs-12 col-sm-4">
            <%= submit_tag 'Search', class: 'btn btn-default' %>
          </div>
          <div id="project-filters">
          </div>
        </div>
    </div>
    <p>
      To get involved in any of the projects, join one of the
      <%= link_to 'scrums', events_path %>
      and reach out to us, or send us an email at
      <a href="mailto:info@agileventures.org">info@agileventures.org</a>.
    </p>

<nav id="sidebar">
<ul id="project-list">
  <% @projects.each_with_index do |p, index| %>
    <% project = p %>
    <% should_focus = false %>
    <% has_docs = p.documents.any? %>
    <% show_it = (p.status == 'active' || p.status == 'Active' ? true : false) %>
    <% follower_count = p.followers.count %>
    <% commit_count = p.commit_count %>
    <% content_tag :li, "", style: show_it ? '' : 'display: none;', class: show_it ? '' : 'inactive' %>
        <div style="display: flex">
            <% if has_docs %>
              <a href="#collapse<%= index %>" class="collapse-button" data-toggle="collapse">
              <i class="collapse-icon fa fa-caret-<%= has_docs and should_focus ? 'down' : 'right' %>"></i>
            </a>
            <% end %>
          <%= link_to p.title, project_path(p), class: should_focus ? 'focused' : show_it ? '' : 'inactive', style: show_it ? '' : 'display: none;' %>
          <%= content_tag :i, "", style: show_it ? '' : 'display: none;', class: show_it ? 'fa fa-users' : 'inactive' %>
          <%= content_tag :div, follower_count, style: show_it ? '' : 'display: none;', class: show_it ? '' : 'inactive' %>
          <% unless commit_count.nil? or commit_count == 0 %>
                <%= content_tag :i, "", style: show_it ? '' : 'display: none;', class: show_it ? 'fa fa-github-alt' : 'inactive' %>
                <%= content_tag :div, commit_count, style: show_it ? '' : 'display: none;', class: show_it ? '' : 'inactive' %>
          <% end %>
        </div>
    </li>
    <% if has_docs %>
      <ul id="collapse<%= index %>" class="<%= project == p ? 'in' : 'collapse' %>" style="<%= show_it ? '' : 'display: none;' %>">
        <% p.documents.roots.each do |d| %>
          <% doc_focus = (should_focus and (@document == d or @document.try(&:root) == d)) %>
          <li>
            <% display_text = %Q{#{d.title}#{" (#{d.children.count})" unless d.children.empty?}} %>
            <% if doc_focus and @document == d %>
              <p class="sidebar-selected"><%= display_text %></p>
            <% else %>
              <%= link_to display_text, project_document_path(p, {id: d.to_param}), class: doc_focus ? 'focused' : '' %>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% end %>
  <% end %>
</ul>
</nav>


  <% end %>
<% end %>
